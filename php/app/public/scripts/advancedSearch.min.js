var advancedSearch={searchModalities:null,analysisDistance:null,analysisLevenshtein:null,analysisStartsWith:null,translate:null,referenceConditionDiv:null,init:function(a){this.searchModalities=a.searchModalities;this.analysisDistance=a.analysisDistance;this.analysisLevenshtein=a.analysisLevenshtein;this.analysisStartsWith=a.analysisStartsWith;this.translate=a.translate;this.referenceConditionDiv='<div class="filter">'+$("div.filter").first().html()+"</div>";if($("div.filter").length>1){$("div.filter").first().remove()}this._addConditionButtonListeners();this._addFieldListener();this._addSubmitListener();this._addSelectAnalysisListener();this._addTextInputListener();if($.browser.mozilla){$("#advancedSearchForm").attr("autocomplete","off")}return this},_addConditionButtonListeners:function(){$("#addConditionSpan").click(function(){$("#filters").append(advancedSearch.referenceConditionDiv);$("div.filter").last().show();$("div.filter").last().find("span.removeCondition").show()});$("span.removeCondition").live("click",function(){$(this).closest("div.filter").remove();$("div.operator").last().hide()})},_addFieldListener:function(){$(".field").livequery("change",function(){var a=$(this).closest("div").find("select.operators").first(),b=$(this).closest("div").find("select.operators").last();if($(this).val()==advancedSearch.searchModalities){a.hide();a.attr("disabled","disabled");b.show();b.removeAttr("disabled")}else{b.hide();b.attr("disabled","disabled");a.show();a.removeAttr("disabled")}})},_addSubmitListener:function(){$("#advancedSearchForm").submit(function(){var a=false;$(this).find("div.filter").each(function(b,c){if(!a&&!advancedSearch.checkCondition($(this))){a=true}});return !a})},_addSelectAnalysisListener:function(){$("select.analysis").livequery("change",function(){var a=$(this).siblings("span.distanceValue");var b=$(this).siblings("span.levenshtein");if($(this).val()==advancedSearch.analysisDistance){if(a.css("display")=="none"){a.css("display","inline");$(this).siblings("input.text").val(advancedSearch.translate.distanceTip)}}else{if(a.css("display")!="none"){a.css("display","none");if($(this).siblings("input.text").val()==advancedSearch.translate.distanceTip){$(this).siblings("input.text").val("")}}}if($(this).val()==advancedSearch.analysisLevenshtein){if(b.css("display")=="none"){b.css("display","inline")}}else{if(b.css("display")!="none"){b.css("display","none")}}})},_addTextInputListener:function(){$("input.text").live("focus",function(){if($(this).siblings("select.analysis").val()==advancedSearch.analysisDistance&&$(this).val()==advancedSearch.translate.distanceTip){$(this).val("")}})},checkCondition:function(b){var c,g,f=true,e,a,d;e=b.find("input.text");c=e.val();g=b.find("select.analysis").val();a=b.find("p.errorMessage");if(!this.isAlnum(c)){d=this.translate.errorAlnum;f=false}if(this.hasLuceneOperator(c)){d=this.translate.errorOperator;f=false}switch(g){case this.analysisStartsWith:if(this.wordCount(c)!=1){d=this.translate.errorStart;f=false}break;case this.analysisLevenshtein:if(this.wordCount(c)!=1){d=this.translate.errorLevenshtein;f=false}break;case this.analysisDistance:if(this.wordCount(c)!=2){d=this.translate.errorDistance;f=false}break}if(!f){e.addClass("error");b.addClass("error");a.html(d);a.show()}else{if(b.hasClass("error")){b.removeClass("error")}if(e.hasClass("error")){e.removeClass("error");a.hide()}}return f},isAlnum:function(c){var b,a;a=new RegExp("([^a-zA-Z0-9àáâãäçèéêëìíîïñòóôõöùúûüýÿÀÁÂÃÄÇÈÉÊËÌÍÎÏÑÒÓÔÕÖÙÚÛÜÝ ])","g");b=c.match(a);if(b!==null&&b.length>0){return false}return true},hasLuceneOperator:function(c){var b,a;a=new RegExp("(AND|OR|NOT)","g");b=c.match(a);if(b!==null&&b.length>0){return true}return false},wordCount:function(a){a=jQuery.trim(a);return a.split(/\s/).length}};